{
    "collab_server" : "",
    "contents" : "redata<-read.csv(\"comb.csv\", header = TRUE)\n\n\n\nrequire(ggplot2)\n#底下的圖都用黑白配色（theme_bw）\nold <- theme_set(theme_bw())\n#看不同性別數學分數的盒鬚圖\n\np1<-ggplot(data = redata, aes(x = Region, \n                          y = Disabled.Aged.Beds.of.every.millon.people)) +\n  geom_boxplot() + coord_flip() +\n  labs( y = 'Region', x = 'beds', \n        title = 'Mathematical Score Box')\n\n#看信賴區間\nwith(dta, \n     tapply(math, gender,\n            function(x) \n              c(mean(x) + c(-2, 2) * sd(x)/sqrt(length(x)))))\n#以t檢定比較不同性別的數學差異\n#預設作法會做 Welch 校正，處理兩樣本變異數不相同的問題\nt.test(math ~ gender, data = dta)\n#這是一般假設變異數同值下的 t 檢定\nt.test(math ~ gender, data = dta, var.equal = TRUE)\n\n#看不同父母教育背景者的數學成績差異\n#先把父母教育各個水準順序定下來\ndta$parental.education <- factor(dta$parental.education, \n                                 levels = c('elementary school',\n                                            'junior high school',\n                                            'high school',\n                                            'college', \n                                            'university above'))\n#看不同父母教育程度下的數學分數平均數\ntapply(dta$math, dta$parental.education, mean)\n\nlibrary(Hmisc)\n#同父母教育程度下的數學分數平均數，加上信賴區間\nggplot(data = dta, \n       aes(x = parental.education, y = math)) +\n  stat_summary(fun.data = 'mean_cl_boot', size = 1) +\n  scale_y_continuous(breaks = seq(500, 660, by = 20)) +\n  geom_hline(yintercept = mean(dta$math) , \n             linetype = 'dotted') +\n  labs(x = '父母教育', y = '數學平均分數') +\n  coord_flip()\n\n# anova檢定 \nanova(m1 <- lm(math ~ parental.education, data = dta))\n\n#父母教育的效果或許會是教育資源造成的，畫圖看看\nggplot(data = dta, \n       aes(group = parental.education, \n           y = math, x = educational.resources)) +\n  geom_point() +\n  stat_smooth(method = 'lm', se = F) +\n  stat_smooth(aes(group = parental.education, \n                  y = math, x = educational.resources), \n              method = 'lm', se = F) + \n  facet_grid( . ~  parental.education) +\n  labs(x = '教育資源', y = '數學分數')\n\n#把教育資源加進模型\nanova(m2 <- update(m1, . ~ . + \n                     educational.resources, data = dta))\n#或許不是父母教育而是教育資源造成\nanova(m3 <- update(m2, . ~ . - \n                     parental.education,  data = dta))\n#將結果放在一個list中\nres_lm <- lapply(list(m1, m2, m3), summary)\n#比較在控制教育資源下，父母教育的效果\n(res_lm[[2]]$r.sq - res_lm[[3]]$r.sq)/res_lm[[2]]$r.sq\nanova(m3, m2)\n#比較在控制父母教育下，教育資源的效果\n(res_lm[[2]]$r.sq - res_lm[[1]]$r.sq)/res_lm[[1]]$r.sq\nanova(m1, m2)\n\n#畫效果\nrequire(coefplot)\n#將截距去除，畫更易懂起來\nm2 <- lm(math ~ parental.education+educational.resources- 1, \n         data = dta)\ncoefplot(m2, xlab = '估計值', ylab = '迴歸變項', title = '反應變項 = 數學分數')\n\n#把資料與迴歸分析的預測值、殘差與影響度放進資料\nfit_m2 <- data.frame(dta[, c(2, 12, 13)], fitted = fitted(m2), resid = resid(m2),\n                     infl = influence(m2)$hat )\n\n#疊合真實觀測值預測值的直方圖，依父母教育\nggplot(data = fit_m2, aes(x = math, group = parental.education )) +\n  stat_density(geom = 'path', position = 'identity') +\n  stat_density(geom = 'path', position = 'identity', aes(x = fitted)) +\n  geom_vline(xintercept = c(with(dta, tapply(math,parental.education, mean))), linetype = 'dotted')+\n  facet_grid(parental.education ~ .) +\n  scale_x_continuous(breaks = seq(200, 900, by = 100))+\n  labs(x = '數學分數', y = '機率密度')\n\n#看殘差分配，依父母教育，檢視常態與變異數同質假設\nggplot(data = fit_m2, aes(x = scale(resid)), group = parental.education ) +\n  stat_density(geom = 'path', position = 'identity', aes(linetype = parental.education)) +\n  scale_linetype_manual(values = 5:1) +\n  guides(linetype = guide_legend(reverse = TRUE)) +\n  labs(x = '標準化殘差', y = '機率密度') +\n  theme(legend.position = c(.15, .8))\n\n#看看殘差的 Q-Q 圖，依父母教育。檢視常態假設\nrequire(lattice)\nqqmath(~ scale(resid) | parental.education, data = fit_m2, type = c('p', 'g', 'r'),\n       xlab = '常態位數', ylab = '標準化殘差', layout = c(2, 3),\n       pch = '.', cex = 2)\n\n#畫預測值與殘差的散佈圖，檢查線性與等分散假設\nrequire(MASS)\nggplot(data = fit_m2, aes(x = fitted, y = scale(resid), group = parental.education )) +\n  geom_point(pch = 20, size = 1) +\n  stat_smooth(method = 'rlm', se = F) +\n  facet_grid(parental.education ~ .) +\n  labs(x = '數學預測值', y = '標準化殘差')\n\n#呈現影響值（影響估計結果過大的值）與標準化殘差\nggplot(data = fit_m2, aes(x = infl, y = scale(resid), group = parental.education)) +\n  geom_text(aes(label = rownames(fit_m2)), cex = 2) +\n  geom_hline(yintercept = 0, linetype = 'dotted') +\n  facet_grid(parental.education ~ .) +\n  labs(x = '影響值', y = '標準化殘差')\n\n#看看影響值\nsummary(influence(m2)$hat)\n\n#改回舊的配色，不然 R 就黑白下去了\ntheme_set(old)\n\n\n\n#底下要呈現多個連續解釋變項時的情形\n#看看個人變項的可能效果，把跟數學有關的部分取出來\ndta_math <- dta[, c('math', 'math.interest', \n                    'math.evaluation', 'math.input')]\n\n#看看基本統計量\ncolMeans(dta_math)\n\n#呈現兩兩散佈圖\nrequire(heplots)\nscatterplotMatrix(~ math + math.interest + math.evaluation + math.input, data= dta_math,\n                  pch = '.', cex = 3, smooth = FALSE, reg.line = FALSE, ellipse = TRUE,\n                  diagonal = 'none', lower.panel = NULL)\n\n#載入corrplot 套件，以圖形顯示相關大小\nrequire(corrplot)\ncorrplot(cor(dta_math), method = 'ellipse', order = 'hclust', addrect = 4,\n         type = 'upper', tl.pos = 'tp')\ncorrplot(cor(dta_math), add = TRUE, type = 'lower', method = 'number',\n         order = 'hclust', col = 'black', diag = FALSE, tl.pos = 'n', cl.pos = 'n')\n\n#放進三個解釋變項\nsummary(m4 <- lm(math ~ math.interest + math.evaluation + math.input, data = dta_math))\n\n#看效果\ncoefplot(m4, predictors = c('math.interest', 'math.evaluation', \n                            'math.input'),\n         xlab = '估計值', ylab = '迴歸變項(去除截距)', title = '反應變項是數學分數')\n\n#看效果\nrequire(effects)\nplot(allEffects(m4), main = '', ylim = c(550, 670), grid = T)\n\n#載入 lm.beta套件，計算標準化迴歸係數\nlibrary(lm.beta)\nsummary(lm.beta(m4))\n\n#看看控制數學興趣與數學評價後，數學投入的效果\nsummary(m5 <- update(m4, . ~ . - math.input , data = dta_math))\nanova(m5, m4)\n",
    "created" : 1495492772399.000,
    "dirty" : true,
    "encoding" : "",
    "folds" : "",
    "hash" : "4086446510",
    "id" : "A4F3D5AA",
    "lastKnownWriteTime" : 13229676095799416,
    "last_content_update" : 1495559064791,
    "path" : null,
    "project_path" : null,
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}